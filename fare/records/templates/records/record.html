{# -*- coding: utf-8 -*-

    Copyright (C) 2019 Open Education Polito.

    fare is free software; you can redistribute it and/or modify it under the
  terms of the MIT License; see LICENSE file for more details.
#}

{%- extends config.RECORDS_UI_BASE_TEMPLATE %}

{%- macro record_content(data) %}
  {% for key, value in data.items() recursive %}
    <li class="list-group-item">
    {% if value is mapping %}
        <strong>{{ key }}:</strong>
        <ul class="list-group">{{ loop(value.items()) }}</ul>
    {% elif value is iterable and value is not string %}
        <strong>{{ key }}:</strong>
        <ol>
        {% for item in value %}
          <li>
          {% if item is mapping %}
            <ul class="list-group">
              {{ record_content(item) }}
            </ul>
          {% else %}
            {{ item }}
          {% endif %}
          </li>
        {% endfor %}
        </ol>
    {% else %}
      <strong>{{ key }}:</strong> {{ value }}
    {% endif %}
    </li>
  {% endfor %}
{%- endmacro %}

{%- block page_body %}

{% if ( ((current_user.has_role('admin') or current_user.has_role('staff')) and 
            record.revisioned == False )
            or
            (record.revisioned == True) )%}

<div class="container">
  <h2>{{record.title}}</h2>
  <div class="panel panel-default">
    <ul class="list-group">
      {{ record_content(record) }}
    </ul>
        {% if current_user.has_role('admin') or current_user.id==record.owner %}
	<form action="{{ url_for('file_management.delete') }}" method="POST">
		<input type="text" name="record_bucket" value={{ record._bucket }} readonly hidden/>
		<input type="text" name="record_id" value={{ record.id }} readonly hidden/>
		<input type="submit" value="Delete" />
	</form>
        {% endif %}
        {% if current_user.has_role('admin') or current_user.has_role('staff') %}
            {% if record.revisioned == False %}
	        <form action="{{ url_for('file_management.publish') }}" method="POST">
		        <input type="text" name="record_bucket" value={{ record._bucket }} readonly hidden/>
		        <input type="text" name="record_id" value={{ record.id }} readonly hidden/>
		        <input type="submit" value="Publish" />
	        </form>
            {% endif %}
        {% endif %}
	<form action="{{ url_for('file_management.download') }}" method="POST">
		<input type="text" name="record_bucket" value={{ record._bucket }} readonly hidden/>
		<input type="text" name="record_id" value={{ record.id }} readonly hidden/>
		<input type="submit" value="Download" />
	</form>
  </div>
</div>

{% endif %}
{%- endblock %}
